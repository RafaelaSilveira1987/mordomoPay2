<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MordomoPay - Gest√£o Crist√£ Inteligente</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ===== CSS ORIGINAL (SEM ALTERA√á√ïES VISUAIS) ===== */
*{margin:0;padding:0;box-sizing:border-box}
:root{
--primary:#2563eb;--primary-dark:#1e40af;
--success:#10b981;--danger:#ef4444;
--bg:#f8fafc;--card:#fff;--text:#1e293b;--muted:#64748b;--border:#e2e8f0;
}
body{
font-family:'Inter',sans-serif;
background:linear-gradient(135deg,#667eea,#764ba2);
min-height:100vh;color:var(--text)
}
.hidden{display:none!important}

/* Loader */
.loader{position:fixed;inset:0;background:#000c;display:flex;align-items:center;justify-content:center;z-index:9999}
.spinner{width:50px;height:50px;border:4px solid #fff4;border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Toast */
.toast{position:fixed;top:20px;right:20px;background:#fff;padding:15px 25px;border-radius:10px;
box-shadow:0 10px 30px #0003;z-index:10000}
.toast.success{border-left:4px solid var(--success)}
.toast.error{border-left:4px solid var(--danger)}

/* Layout */
.dashboard-layout{display:flex;min-height:100vh}
.sidebar{width:280px;background:#fff;padding:30px 20px;box-shadow:2px 0 10px #0001}
.nav-item{width:100%;padding:15px;border:none;border-radius:10px;background:none;
display:flex;gap:10px;cursor:pointer;font-size:15px}
.nav-item.active{background:var(--primary);color:#fff}
.main{flex:1;padding:30px;background:var(--bg)}
.card{background:#fff;border-radius:15px;padding:25px;margin-bottom:25px;box-shadow:0 2px 10px #0001}
.btn{padding:10px 20px;border:none;border-radius:10px;font-weight:600;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-block{width:100%}

table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid var(--border)}
</style>
</head>

<body>
<div id="loader" class="loader hidden"><div class="spinner"></div></div>
<div id="toast" class="toast hidden"></div>

<!-- LOGIN -->
<div id="login-page">
<div class="card" style="max-width:420px;margin:80px auto">
<h2>MordomoPay</h2><br>
<form id="login-form">
<input id="celular" placeholder="553298416669" required style="width:100%;padding:10px"><br><br>
<input id="password" type="password" placeholder="Senha" required style="width:100%;padding:10px"><br><br>
<button class="btn btn-primary btn-block">Entrar</button>
</form>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard-page" class="hidden">
<div class="dashboard-layout">

<aside class="sidebar">
<button class="nav-item active" data-page="dashboard">üìä Dashboard</button>
<button class="nav-item" data-page="transactions">üí≥ Transa√ß√µes</button>
<button id="logout" class="btn btn-danger btn-block" style="margin-top:20px">Sair</button>
</aside>

<main class="main">
<h2 id="page-title">Dashboard</h2><br>

<!-- DASH -->
<div id="dashboard-content">
<div class="card">
<p>Entradas: <b id="total-income">R$ 0,00</b></p>
<p>Sa√≠das: <b id="total-expenses">R$ 0,00</b></p>
<p>Saldo: <b id="total-balance">R$ 0,00</b></p>
</div>
</div>

<!-- TRANSA√á√ïES -->
<div id="transactions-content" class="hidden">
<div class="card">
<div style="display:flex;justify-content:space-between">
<h3>Transa√ß√µes</h3>
<button class="btn btn-primary" onclick="openModal()">+ Nova</button>
</div>

<table>
<thead>
<tr><th>Data</th><th>Descri√ß√£o</th><th>Tipo</th><th>Valor</th><th></th></tr>
</thead>
<tbody id="tx-list"></tbody>
</table>
</div>
</div>

</main>
</div>
</div>

<!-- MODAL -->
<div id="modal" class="loader hidden">
<div class="card" style="max-width:400px">
<h3>Nova Transa√ß√£o</h3><br>

<label>Tipo</label>
<select id="tx-tipo" style="width:100%;padding:8px">
<option value="entrada">Entrada</option>
<option value="saida">Sa√≠da</option>
</select><br><br>

<label>Descri√ß√£o</label>
<input id="tx-desc" style="width:100%;padding:8px"><br><br>

<label>Valor</label>
<input id="tx-val" type="number" step="0.01" style="width:100%;padding:8px"><br><br>

<label>Data</label>
<input id="tx-date" type="date" style="width:100%;padding:8px"><br><br>

<button class="btn btn-primary btn-block" onclick="saveTx()">Salvar</button><br><br>
<button class="btn btn-block" onclick="closeModal()">Cancelar</button>
</div>
</div>

<script>
/* ===== SUPABASE ===== */
const supabaseClient = supabase.createClient(
'https://fetimotrijqyswrfoyzz.supabase.co',
'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZldGltb3RyaWpxeXN3cmZveXp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MTk5MTksImV4cCI6MjA3NTA5NTkxOX0.Wkiu887LiK1l3k4vHpoRB-ODsrxeUF_mJINJmJ2Xz4I'
);

let currentUser=null,editId=null;

/* ===== UTIL ===== */
const $=id=>document.getElementById(id);
const toast=(m,t='success')=>{
$('toast').textContent=m;
$('toast').className=`toast ${t}`;
$('toast').classList.remove('hidden');
setTimeout(()=>$('toast').classList.add('hidden'),3000);
}

/* ===== LOGIN ===== */
$('login-form').onsubmit=async e=>{
e.preventDefault();$('loader').classList.remove('hidden');
const {data,error}=await supabaseClient.rpc('login_usuario',{
p_celular:$('celular').value,
p_senha:$('password').value
});
$('loader').classList.add('hidden');

if(error||!data?.length){toast('Login inv√°lido','error');return}
currentUser=data[0];
$('login-page').classList.add('hidden');
$('dashboard-page').classList.remove('hidden');
loadTx();loadDash();
}

/* ===== NAV ===== */
document.querySelectorAll('.nav-item').forEach(b=>{
b.onclick=()=>{
document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
b.classList.add('active');
$('dashboard-content').classList.add('hidden');
$('transactions-content').classList.add('hidden');
$(b.dataset.page+'-content').classList.remove('hidden');
$('page-title').textContent=b.textContent;
}
});

/* ===== CRUD ===== */
async function loadTx(){
const {data}=await supabaseClient.from('transacoes')
.select('*').eq('usuario_id',currentUser.id).order('data',{ascending:false});
$('tx-list').innerHTML='';
data?.forEach(t=>{
$('tx-list').innerHTML+=`
<tr>
<td>${t.data}</td>
<td>${t.descricao}</td>
<td>${t.tipo}</td>
<td style="color:${t.tipo=='entrada'?'green':'red'}">R$ ${t.valor.toFixed(2)}</td>
<td>
<button onclick='edit(${JSON.stringify(t)})'>‚úèÔ∏è</button>
<button onclick='del("${t.id}")'>üóëÔ∏è</button>
</td>
</tr>`;
});
}

async function saveTx(){
const payload={
usuario_id:currentUser.id,
tipo:$('tx-tipo').value,
descricao:$('tx-desc').value,
valor:Number($('tx-val').value),
data:$('tx-date').value
};
editId
?await supabaseClient.from('transacoes').update(payload).eq('id',editId)
:await supabaseClient.from('transacoes').insert(payload);
closeModal();loadTx();loadDash();toast('Salvo!');
}

function edit(t){
editId=t.id;
$('tx-tipo').value=t.tipo;
$('tx-desc').value=t.descricao;
$('tx-val').value=t.valor;
$('tx-date').value=t.data;
openModal();
}

async function del(id){
if(confirm('Excluir?')){
await supabaseClient.from('transacoes').delete().eq('id',id);
loadTx();loadDash();toast('Exclu√≠do');
}
}

/* ===== DASH ===== */
async function loadDash(){
const {data}=await supabaseClient.from('transacoes')
.select('tipo,valor').eq('usuario_id',currentUser.id);
let i=0,o=0;
data?.forEach(t=>t.tipo=='entrada'?i+=t.valor:o+=t.valor);
$('total-income').textContent=`R$ ${i.toFixed(2)}`;
$('total-expenses').textContent=`R$ ${o.toFixed(2)}`;
$('total-balance').textContent=`R$ ${(i-o).toFixed(2)}`;
}

/* ===== MODAL ===== */
function openModal(){editId=null;$('modal').classList.remove('hidden')}
function closeModal(){$('modal').classList.add('hidden')}

/* ===== LOGOUT ===== */
$('logout').onclick=()=>location.reload();
</script>
</body>
</html>
